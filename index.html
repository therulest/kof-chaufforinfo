<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chauff√∂rinfo</title>
<style>
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    margin:16px;
    background:#fafafa;
  }
  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
    flex-wrap:wrap;
    gap:8px;
  }
  h1{margin:0}
  .grid{
    display:grid;
    grid-gap:12px;
  }
  .card{
    border:1px solid #e3e3e3;
    border-radius:12px;
    padding:12px;
    background:white;
    box-shadow:0 1px 3px rgba(0,0,0,0.05);
    white-space:pre-wrap;
  }
  .muted{
    color:#6b7280;
    font-size:12px;
  }
  @media(min-width:700px){
    .grid{grid-template-columns:repeat(auto-fit,minmax(240px,1fr));}
  }

  /* --- Knappar och select --- */
  #refreshBtn {
    background:#007bff;
    color:white;
    border:none;
    padding:8px 14px;
    border-radius:8px;
    font-size:14px;
    cursor:pointer;
    transition:all 0.2s;
    margin-left:8px;
  }
  #refreshBtn:hover { background:#005dc3; }
  #refreshBtn:active { transform:scale(0.97); }

  #bilSelect {
    padding:8px 12px;
    border:1px solid #d1d5db;
    border-radius:8px;
    font-size:14px;
    background:white;
    cursor:pointer;
    transition:border-color 0.2s;
  }
  #bilSelect:hover {
    border-color:#007bff;
  }
</style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <h1>Dagens turer</h1>
      <select id="bilSelect"></select>
      <button id="refreshBtn">üîÑ Uppdatera</button>
    </div>
    <div class="muted" id="stamp"></div>
  </header>

  <div class="grid" id="grid"></div>

<script>
let allBlocks = []; // lagrar alla bilars info

async function loadData(){
  const grid = document.getElementById('grid');
  grid.innerHTML = '<p>Laddar...</p>';
  try{
    const res = await fetch('./data.json?v=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json(); // { updated_at, blocks:[ "Bil 1\n...", ... ] }

    document.getElementById('stamp').textContent =
      'Senast uppdaterad: ' + (new Date(data.updated_at)).toLocaleString();

    allBlocks = data.blocks || [];
    if(!allBlocks.length){
      grid.innerHTML = '<p>Inga turer tillg√§ngliga.</p>';
      return;
    }

    // Fyll dropdown
    const sel = document.getElementById('bilSelect');
    sel.innerHTML = "";
    allBlocks.forEach((b, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      // F√∂rs√∂k plocka ut "Bil X" fr√•n b√∂rjan av texten
      const match = b.match(/Bil\s*\d+/i);
      opt.textContent = match ? match[0] : `Bil ${i+1}`;
      sel.appendChild(opt);
    });
    sel.selectedIndex = 0;

    // Visa Bil 1 som standard
    showSelectedBil();

  }catch(e){
    grid.innerHTML = '<p style="color:#b00020;">Kunde inte l√§sa data.json</p>';
    console.error(e);
  }
}

function showSelectedBil(){
  const grid = document.getElementById('grid');
  const sel = document.getElementById('bilSelect');
  const index = sel.value;
  grid.innerHTML = '';

  if(allBlocks[index]){
    const div = document.createElement('div');
    div.className = 'card';
    div.textContent = allBlocks[index];
    grid.appendChild(div);
  }
}

// H√§ndelser
document.getElementById('refreshBtn').addEventListener('click', loadData);
document.getElementById('bilSelect').addEventListener('change', showSelectedBil);

// Ladda automatiskt vid start
loadData();
</script>
</body>
</html>
