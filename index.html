<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KOF – Chaufförportal</title>

<style>
:root{
  --border:#e5e7eb;
  --shadow:0 1px 3px rgba(0,0,0,.05);
}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f9fafb;color:#111}
main{max-width:1200px;margin:0 auto;padding:16px}

.topbar{display:flex;align-items:center;justify-content:space-between;
  background:#fff;border-bottom:1px solid #e5e7eb;padding:10px 16px;position:sticky;top:0;z-index:10}
.topbar h1{margin:0;font-size:17px;color:#0284c7}
.topbar .nav{display:flex;gap:20px}
.topbar a{text-decoration:none;color:#333}
.topbar a.active{color:#0284c7;font-weight:600}

/* Mobilmeny */
.mobile-launcher{display:none;max-width:1200px;margin:12px auto 0;padding:0 16px}
.ml-wrap{background:#f2f3f7;border:1px solid #e9e9ee;border-radius:18px;padding:14px;
         display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.ml-item{display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px 4px;border-radius:12px}
.micon{width:48px;height:48px;border-radius:50%;background:#fff;display:grid;place-items:center;
       box-shadow:0 1px 3px rgba(0,0,0,.08);font-size:24px}
.ml-label{font-size:13px;color:#111827}
@media(max-width:700px){
  .topbar .nav{display:none}
  .mobile-launcher{display:block}
}

/* Kortlayout */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:16px;margin-top:10px}
.card{border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:var(--shadow);
  overflow:hidden;cursor:pointer;transition:box-shadow .15s ease}
.card:hover{box-shadow:0 3px 10px rgba(0,0,0,.08)}
.card-header{display:flex;align-items:center;gap:10px;padding:12px}
.chev{transition:transform .18s ease;user-select:none;font-size:16px}
.card.expanded .chev{transform:rotate(90deg)}
.summary{white-space:pre-wrap;margin:0;flex:1;font-size:14px;line-height:1.3}

.divider{border:none;border-top:1px solid #eee;margin:0}
.details{display:none;padding:10px 14px 12px}
.card.expanded .details{display:block}
.details ul{margin:8px 0 0 0;padding-left:20px;line-height:1.4}
.details li{margin-bottom:6px}
.details li.store{font-weight:600;color:#111827}
.details li.qty{color:#4b5563}
.details li.qtyblock>div{line-height:1.3}
.details li.total{font-weight:600}
.details li.note{margin-top:6px;color:#991b1b}

/* Övrigt */
footer{margin-top:30px;color:#6b7280;font-size:13px;text-align:right}
</style>
</head>
<body>

<header class="topbar">
  <h1>KOF – Chaufförportal</h1>
  <nav class="nav">
    <a href="#" class="active">Home</a>
    <a href="#">Dagab</a>
    <a href="#">Nyheter</a>
    <a href="#">Kontakter</a>
  </nav>
</header>

<!-- MOBILMENY -->
<div class="mobile-launcher">
  <div class="ml-wrap">
    <a class="ml-item" href="#"><span class="micon">🏠</span><span class="ml-label">Home</span></a>
    <a class="ml-item" href="#"><span class="micon">🚚</span><span class="ml-label">Dagab</span></a>
    <a class="ml-item" href="#"><span class="micon">📰</span><span class="ml-label">Nyheter</span></a>
    <a class="ml-item" href="#"><span class="micon">👥</span><span class="ml-label">Kontakter</span></a>
  </div>
</div>

<main>
  <h2>Dagens turer</h2>
  <div id="grid" class="grid"></div>
  <footer id="status"></footer>
</main>

<script>
const dataUrl = "https://therulest.github.io/kof-chaufforinfo/data.json";

async function loadData(){
  try {
    const res = await fetch(dataUrl + "?v=" + Date.now());
    if(!res.ok) throw new Error(res.status);
    const json = await res.json();
    buildAll(json);
  } catch(err){
    document.getElementById('status').textContent = "Kunde inte läsa data: " + err;
  }
}

function buildAll(json){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const cars = json.cars || [];
  cars.forEach((car,i)=>grid.append(buildCard(car,i)));
  const t = new Date(json.updated_at || Date.now());
  document.getElementById('status').textContent =
    "Senast uppdaterad: " + t.toLocaleString('sv-SE');
}

function buildCard(car, idx, expanded=false){
  const card = document.createElement('div');
  card.className = 'card' + (expanded ? ' expanded' : '');

  // --- säkra data ---
  const summaryText = String(car.summary || '');
  const allLines = summaryText.split(/\r?\n/);
  const headLines = allLines.slice(0, 6);             // rad 1–6 i headern
  let detailsLines = Array.isArray(car.details) && car.details.length
    ? car.details.map(String)
    : allLines.slice(6);                               // annars rad 7–… ur summary

  // --- header ---
  const header = document.createElement('div');
  header.className = 'card-header';
  const chev = document.createElement('span');
  chev.className = 'chev';
  chev.textContent = '▶';
  const pre = document.createElement('pre');
  pre.className = 'summary';
  pre.textContent = headLines.join('\n');
  header.append(chev, pre);
  card.append(header);

  // --- details (dold) ---
  if (detailsLines.length) {
    card.append(Object.assign(document.createElement('hr'), {className:'divider'}));
    const details = document.createElement('div');
    details.className = 'details';
    const ul = document.createElement('ul');

    for (let i = 0; i < detailsLines.length; i++) {
      const line = detailsLines[i];
      const lower = line.toLowerCase().trim();

      // Grupp Frys/Kyl/Kol i ett block
      if (/^frys\s*:/.test(lower)) {
        const group = [line];
        const n1 = detailsLines[i+1] || '', n2 = detailsLines[i+2] || '';
        if (/^\s*kyl\s*:/.test(String(n1).toLowerCase())) { group.push(n1); i++; }
        if (/^\s*kol\s*:/.test(String(n2).toLowerCase())) { group.push(n2); i++; }
        const li = document.createElement('li');
        li.className = 'qtyblock';
        li.innerHTML = group.map(t => `<div>${escapeHtml(t)}</div>`).join('');
        ul.append(li);
        continue;
      }

      // Vanlig rad
      const li = document.createElement('li');
      li.textContent = line;

      const isQty   = /\b(frys|kyl|kol)\b/.test(lower);
      const isTotal = lower.startsWith('totalt');
      const isNote  = lower.startsWith('glöm') || lower.startsWith('glom');

      if (isQty)   li.classList.add('qty');
      if (isTotal) li.classList.add('total');
      if (isNote)  li.classList.add('note');

      // Butiksrad = nästa rad är qty
      const next = detailsLines[i+1];
      if (next) {
        const nextIsQty = /\b(frys|kyl|kol)\b/.test(String(next).toLowerCase());
        if (!isQty && !isTotal && !isNote && nextIsQty) li.classList.add('store');
      }

      ul.append(li);
    }

    details.append(ul);
    card.append(details);
  }

  // --- expand/collapse på klick ---
  card.addEventListener('click', (e) => {
    if (e.target.closest('button,select,a')) return; // ignorerar klick på kontroller
    if (!card.querySelector('.details')) return;
    card.classList.toggle('expanded');
  });

  return card;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

loadData();
</script>

</body>
</html>


